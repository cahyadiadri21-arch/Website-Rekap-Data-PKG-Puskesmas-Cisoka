<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REKAP DATA PKG PUSKESMAS CISOKA</title>

<!-- Bootstrap 5 CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body { font-family: 'Inter', sans-serif; background:#f4f7fa; }
h1 { font-weight:600; }
.card { border-radius:1rem; box-shadow:0 8px 20px rgba(0,0,0,0.05); }
.btn-primary, .btn-success { border-radius:50px; padding:0.5rem 1.5rem; }
.table thead { background-color:#e3f2fd; }
#dataContainer { overflow-x:auto; }
</style>
</head>
<body>

<div class="container py-5">
<h1 class="text-center mb-5">REKAP DATA PKG PUSKESMAS CISOKA</h1>

<div class="card p-4 mb-5">
<form id="formInput">
<div class="row g-3">
  <div class="col-md-6"><label>Nama Siswa</label><input type="text" class="form-control" name="nama" required></div>
  <div class="col-md-6"><label>NIK</label><input type="text" class="form-control" name="nik" required></div>
  <div class="col-md-6"><label>Nama Sekolah</label><input type="text" class="form-control" name="sekolah" required></div>
  <div class="col-md-6"><label>Kelas</label>
    <select class="form-select" name="kelas" required>
      <option value="">Pilih Kelas</option>
      <option>1 SD</option><option>2 SD</option><option>3 SD</option>
      <option>4 SD</option><option>5 SD</option><option>6 SD</option>
      <option>7 SMP</option><option>8 SMP</option><option>9 SMP</option>
      <option>10 SMA</option><option>11 SMA</option><option>12 SMA</option>
    </select>
  </div>
  <div class="col-md-6"><label>Tanggal Pendaftaran</label><input type="date" class="form-control" name="tanggal" required></div>
  <div class="col-md-6"><label>Petugas Entri</label><input type="text" class="form-control" name="petugas" required></div>
  <div class="col-md-6"><label>Unit</label>
    <select class="form-select" name="unit" required>
      <option value="">Pilih Unit</option>
      <option>ANAK</option><option>BP UMUM</option><option>FARMASI</option>
      <option>GIGI</option><option>GIZI PROMKES</option><option>IMUNISASI</option>
      <option>KASIR LOKET</option><option>KIA</option><option>LAB</option>
      <option>LANSIA KESLING</option><option>MANAGEMEN</option><option>PONED</option>
      <option>TB PARU JIWA</option><option>UGD RANAP</option>
    </select>
  </div>
</div>
<div class="mt-4 d-flex gap-2">
  <button type="submit" class="btn btn-primary">Kirim Data</button>
  <button type="button" class="btn btn-success" id="lihatData">Lihat Data</button>
</div>
</form>
</div>

<div id="dataContainer"></div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbycRFYZcqFc5iXJB3_13TsBPCNvqpyHZMIZpeBg2qOsBntlVz1ueCsafqPunsad-LBXHw/exec"; // ganti dengan Web App URL
const form = document.getElementById("formInput");
const dataContainer = document.getElementById("dataContainer");
const btnLihatData = document.getElementById("lihatData");

form.addEventListener("submit", e=>{
  e.preventDefault();
  const formData = new FormData(form);
  const jsonData = Object.fromEntries(formData.entries());
  jsonData.timestamp = new Date().toISOString();
  fetch(scriptURL,{
    method:"POST",
    mode:"cors",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify(jsonData)
  }).then(res=>res.json())
    .then(data=>{
      if(data.result==="success"){alert("‚úÖ Data berhasil dikirim!"); form.reset();}
      else alert("‚ùå Gagal kirim: "+(data.message||"Error"));
    }).catch(err=>alert("‚ö†Ô∏è Gagal kirim: "+err));
});

btnLihatData.addEventListener("click", ()=>{
  const selectedUnit = form.unit.value;
  if(!selectedUnit){alert("‚ö†Ô∏è Pilih dulu UNIT!"); return;}
  fetch(`${scriptURL}?action=read&unit=${encodeURIComponent(selectedUnit)}`)
    .then(res=>res.json())
    .then(data=>{
      if(data.result!=="success"){alert("‚ùå Gagal load: "+(data.message||"Error")); return;}
      let html = `<h5 class="mt-4">üìä Data Unit: ${selectedUnit}</h5>
                  <table class="table table-bordered mt-3">
                  <thead class="table-primary">
                  <tr><th>No</th><th>Nama</th><th>NIK</th><th>Sekolah</th><th>Kelas</th><th>Tanggal</th><th>Petugas</th><th>Unit</th><th>Waktu Input</th></tr>
                  </thead><tbody>`;
      data.data.slice(1).forEach((row,i)=>{
        html+=`<tr>
          <td>${i+1}</td>
          <td>${row[0]||""}</td>
          <td>${row[1]||""}</td>
          <td>${row[2]||""}</td>
          <td>${row[3]||""}</td>
          <td>${row[4]||""}</td>
          <td>${row[5]||""}</td>
          <td>${row[6]||""}</td>
          <td>${row[7]?new Date(row[7]).toLocaleString():""}</td>
        </tr>`;
      });
      html+="</tbody></table>";
      dataContainer.innerHTML = html;
    }).catch(err=>alert("‚ö†Ô∏è Gagal load: "+err));
});
</script>

</body>
</html>
